<view class="club-overview-panel">
  <scroll-view 
    class="overview-scroll" 
    scroll-y 
    bindscrolltolower="onScrollToLower"
    lower-threshold="100"
  >
    <!-- 骨架屏 - 在未初始化或加载中时显示 -->
    <view wx:if="{{!initialized || (loading && clubList.length === 0)}}" class="loading-container">
      <view wx:for="{{[1,2,3,4,5,6]}}" wx:key="*this" class="club-skeleton">
        <view class="club-skeleton-left">
          <t-skeleton animation="gradient" rowCol="{{[{ width: '200rpx', height: '200rpx', borderRadius: '12rpx' }]}}" />
          <view style="margin-top: 12rpx;">
            <t-skeleton animation="gradient" rowCol="{{[{ width: '160rpx', height: '32rpx', marginBottom: '8rpx' }]}}" />
            <t-skeleton animation="gradient" rowCol="{{[{ width: '180rpx', height: '24rpx' }]}}" />
          </view>
        </view>
        <view class="club-skeleton-right">
          <t-skeleton animation="gradient" rowCol="{{[{ width: '100%', height: '400rpx', borderRadius: '12rpx' }]}}" />
        </view>
      </view>
    </view>

    <!-- 协会列表 - 初始化完成且有数据时显示 -->
    <view wx:else class="club-list">
      <view 
        wx:for="{{clubList}}" 
        wx:key="club_id" 
        class="club-item"
      >
        <!-- 左侧：协会信息 -->
        <view 
          class="club-info"
          bindtouchstart="onClubTouchStart"
          bindtouchend="onClubTap"
          data-club-id="{{item.club_id}}"
          data-is-managed="{{item.cur_user_managed}}"
        >
          <image 
            class="club-cover" 
            src="{{item.cover_url}}" 
            mode="aspectFill"
          />
          <view class="club-details">
            <text class="club-name">{{item.club_name}}</text>
            <text class="club-desc">{{item.description}}</text>
          </view>
        </view>

        <!-- 右侧：活动列表（isotope） -->
        <view class="club-events">
          <view wx:if="{{item.eventsLoading}}" class="events-loading">
            <van-loading size="24px" />
            <text class="loading-text">加载活动中...</text>
          </view>
          <isotope
            wx:else
            id="club-isotope-{{item.club_id}}"
            items="{{item.eventItems}}"
            layoutMode="fitRows"
            width="530rpx"
            height="380rpx"
            gutter="10"
            transitionDuration="0.6s"
            backgroundColor="transparent"
            showLabel="{{true}}"
            labelHeight="80"
            labelStyle="{{labelStyle}}"
            bind:itemtap="onEventTap"
          />
        </view>
      </view>

      <!-- 加载更多 -->
      <view wx:if="{{hasMore}}" class="load-more">
        <van-loading wx:if="{{loading}}" size="24px" />
        <text wx:else class="load-more-text">上滑加载更多</text>
      </view>

      <!-- 没有更多 -->
      <view wx:if="{{!hasMore && clubList.length > 0}}" class="no-more">
        <text>没有更多协会了</text>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{!loading && clubList.length === 0 && initialized}}" class="empty-state">
        <t-empty description="暂无协会" />
      </view>
    </view>
  </scroll-view>

  <!-- 嵌套的club-detail弹窗 -->
  <expandable-container_fullscreen 
    wx:if="{{nestedClubDetail.visible}}"
    id="nestedClubDetailPopup" 
    expanded-width="750" 
    expanded-height="1800" 
    bg-color="#fff"
    fullscreen-top-padding="{{0}}"
    bind:collapse="onNestedClubDetailCollapse"
    bind:contentReady="onNestedClubDetailContentReady"
  >
    <view slot="trigger"></view>
    <view slot="content" class="nested-popup-shell">
      <!-- 骨架屏 -->
      <view wx:if="{{nestedClubDetail.loading}}" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 999; background: #fff;">
        <club-detail-skeleton />
      </view>
      
      <!-- 真实 panel 组件 -->
      <block wx:if="{{nestedClubDetail.renderPanel}}">
        <club-detail-panel
          id="nestedClubDetailPanel"
          club-id="{{nestedClubDetail.clubId}}"
          bind:loaded="onNestedClubDetailLoaded"
          bind:close="closeNestedClubDetail"
        />
      </block>
    </view>
  </expandable-container_fullscreen>

  <!-- 嵌套的club-manage弹窗 -->
  <expandable-container_fullscreen 
    wx:if="{{nestedClubManage.visible}}"
    id="nestedClubManagePopup" 
    expanded-width="750" 
    expanded-height="1800" 
    bg-color="#f5f5f5"
    fullscreen-top-padding="{{0}}"
    bind:collapse="onNestedClubManageCollapse"
    bind:contentReady="onNestedClubManageContentReady"
  >
    <view slot="trigger"></view>
    <view slot="content" class="nested-popup-shell">
      <!-- 骨架屏 -->
      <view wx:if="{{nestedClubManage.loading}}" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 999; background: #f5f5f5;">
        <club-manage-skeleton />
      </view>
      
      <!-- 真实 panel 组件 -->
      <block wx:if="{{nestedClubManage.renderPanel}}">
        <club-manage-panel
          id="nestedClubManagePanel"
          club-id="{{nestedClubManage.clubId}}"
          bind:loaded="onNestedClubManageLoaded"
          bind:close="closeNestedClubManage"
        />
      </block>
    </view>
  </expandable-container_fullscreen>

  <!-- 嵌套的event-detail弹窗 -->
  <expandable-container_fullscreen 
    wx:if="{{nestedEventDetail.visible}}"
    id="nestedEventDetailPopup" 
    expanded-width="750" 
    expanded-height="1800" 
    bg-color="#f7f8fa"
    fullscreen-top-padding="{{0}}"
    bind:collapse="onNestedEventDetailCollapse"
    bind:contentReady="onNestedEventDetailContentReady"
  >
    <view slot="trigger"></view>
    <view slot="content" class="nested-popup-shell">
      <!-- 骨架屏 -->
      <view wx:if="{{nestedEventDetail.loading}}" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 999; background: #f7f8fa;">
        <event-detail-skeleton />
      </view>
      
      <!-- 真实 panel 组件 -->
      <block wx:if="{{nestedEventDetail.renderPanel}}">
        <event-detail-panel
          id="nestedEventDetailPanel"
          event-id="{{nestedEventDetail.eventId}}"
          bind:loaded="onNestedEventDetailLoaded"
          bind:close="closeNestedEventDetail"
        />
      </block>
    </view>
  </expandable-container_fullscreen>

  <!-- 嵌套的event-manage弹窗 -->
  <expandable-container_fullscreen 
    wx:if="{{nestedEventManage.visible}}"
    id="nestedEventManagePopup" 
    expanded-width="750" 
    expanded-height="1800" 
    bg-color="#f7f8fa"
    fullscreen-top-padding="{{0}}"
    bind:collapse="onNestedEventManageCollapse"
    bind:contentReady="onNestedEventManageContentReady"
  >
    <view slot="trigger"></view>
    <view slot="content" class="nested-popup-shell">
      <!-- 骨架屏 -->
      <view wx:if="{{nestedEventManage.loading}}" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 999; background: #f7f8fa;">
        <event-manage-skeleton />
      </view>
      
      <!-- 真实 panel 组件 -->
      <block wx:if="{{nestedEventManage.renderPanel}}">
        <event-manage-panel
          id="nestedEventManagePanel"
          event-id="{{nestedEventManage.eventId}}"
          bind:loaded="onNestedEventManageLoaded"
          bind:close="closeNestedEventManage"
        />
      </block>
    </view>
  </expandable-container_fullscreen>
</view>
