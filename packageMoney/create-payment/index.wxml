<!-- 创建群收款页面 -->
<view class="payment-container">
  <!-- 顶部标题 -->
  <view class="page-header">
    <text class="page-title">创建群收款</text>
    <text class="club-title" wx:if="{{clubInfo}}">{{clubInfo.name}}</text>
  </view>

  <!-- 瀑布流主体内容 -->
  <scroll-view scroll-y class="waterfall-scroll">
    <!-- 1. 协会基本信息区块 -->
    <view class="waterfall-block">
      <view class="block-header">
        <van-icon name="friends-o" color="rgb(223, 118, 176)" />
        <text>协会信息</text>
      </view>
      <view class="block-content">
        <!-- 社团选择 -->
        <view class="form-item">
          <text class="form-label required">选择协会</text>
          <van-picker 
            columns="{{ clubColumns }}" 
            title="选择协会"
            default-index="{{ defaultClubIndex }}"
            bind:change="onClubPickerChange"
            value-key="name"
            visible-item-count="{{2}}"
          />
        </view>
      </view>
    </view>
    
    <!-- 2. 日期选择区块 -->
    <view class="waterfall-block">
      <view class="block-header">
        <van-icon name="calendar-o" color="rgb(223, 118, 176)" />
        <text>日期选择</text>
      </view>
      <view class="block-content">
        <view class="form-item">
          <text class="form-label">选择日期范围查看支出记录</text>
          <view class="date-range-picker" bindtap="showCalendar">
            <view class="date-value">{{selectedDate[0]}}</view>
            <view class="date-separator">至</view>
            <view class="date-value">{{selectedDate[1]}}</view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 3. 协会支出列表区块 -->
    <view class="waterfall-block">
      <view class="block-header">
        <van-icon name="balance-list-o" color="rgb(223, 118, 176)" />
        <text>协会支出列表</text>
      </view>
      <view class="block-content">
        <!-- 有支出记录时显示列表 -->
        <view wx:if="{{feeList.length > 0}}" class="fee-list">
          <view class="fee-item" wx:for="{{feeList}}" wx:key="fee_id">
            <view class="fee-left">
              <view class="fee-date">{{item.create_date}}</view>
              <view class="fee-desc">{{item.description}}</view>
            </view>
            <view class="fee-amount">￥{{item.feement}}</view>
          </view>
        </view>
        
        <!-- 无支出记录时显示提示 -->
        <van-empty wx:else description="该时间段内无支出记录" />
      </view>
    </view>
    
    <!-- 4. 创建群收款表单区块 -->
    <view class="waterfall-block">
      <view class="block-header">
        <van-icon name="bill-o" color="rgb(223, 118, 176)" />
        <text>创建协会群收款</text>
      </view>
      <view class="block-content">
        <view class="form-item">
          <text class="form-label required">收款金额</text>
          <van-field
            value="{{ formData.total_fee }}"
            placeholder="请输入收款总金额（将平分给所有成员）"
            border="{{ false }}"
            bind:change="onInputChange"
            data-field="total_fee"
            type="digit"
          />
        </view>
        <view class="form-item">
          <text class="form-label required">收款说明</text>
          <van-field
            value="{{ formData.description }}"
            placeholder="请输入收款用途说明"
            border="{{ false }}"
            bind:change="onInputChange"
            data-field="description"
            maxlength="100"
            show-word-limit
          />
        </view>
        <view class="form-item">
          <text class="form-label">收款日期</text>
          <picker mode="date" value="{{formData.createDate}}" bindchange="onDateChange" data-field="createDate">
            <view class="picker-value">
              {{formData.createDate || '选择日期'}}
            </view>
          </picker>
        </view>
      </view>
    </view>
    
    <!-- 5. 表单按钮 -->
    <view class="waterfall-block">
      <view class="block-content">
        <view class="action-buttons">
          <van-button 
            round 
            color="rgb(153, 153, 153)"
            bindtap="cancelCreate" 
            custom-class="primary-btn"
            style="margin-bottom: 20rpx;"
            disabled="{{submitting}}"
          >
            取消
          </van-button>
          <van-button 
            round 
            color="rgb(223, 118, 176)"
            bindtap="createGroupPayment" 
            custom-class="primary-btn"
            loading="{{submitting}}"
            disabled="{{submitting}}"
          >
            创建群收款
          </van-button>
        </view>
      </view>
    </view>
    
    <!-- 底部填充 -->
    <view class="footer-space"></view>
  </scroll-view>
</view>

<!-- 日期选择日历弹窗 -->
<van-calendar
  show="{{ calendarShow }}"
  type="range"
  color="rgb(223, 118, 176)"
  min-date="{{ minDate }}"
  max-date="{{ maxDate }}"
  default-date="{{ defaultDate }}"
  bind:close="onCalendarClose"
  bind:confirm="onCalendarConfirm"
/>

