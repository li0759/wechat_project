<!-- 通用协会列表Panel -->
<view class="club-panel-container">
  <scroll-view 
    class="clubs-scroll" 
    scroll-y="{{true}}"
    show-scrollbar="{{false}}"
    bindscrolltolower="onScrollToLower"
    enhanced="{{true}}"
  >
    <view class="clubs-container">
      <!-- 协会列表 -->
      <view wx:if="{{clubList.length > 0}}" class="clubs-list">
        <view wx:for="{{clubList}}" wx:key="club_id" class="club-item">
          <!-- 骨架屏 -->
          <view wx:if="{{item.loading}}" class="inline-skeleton-card">
            <!-- 顶部协会名称行 -->
            <view class="inline-skeleton-header">
              <t-skeleton animation="gradient" rowCol="{{[{ width: '150rpx', height: '24rpx' }]}}" />
            </view>
            <!-- 主内容：左边封面 + 右边信息 -->
            <view class="inline-skeleton-content">
              <!-- 左边封面 -->
              <t-skeleton animation="gradient" rowCol="{{[{ width: '150rpx', height: '150rpx', borderRadius: '8rpx' }]}}" />
              <!-- 右边信息 -->
              <view class="inline-skeleton-info">
                <!-- 协会标题 -->
                <t-skeleton animation="gradient" rowCol="{{[{ width: '200rpx', height: '28rpx', marginBottom: '8rpx' }]}}" />
                <!-- 会长信息 -->
                <t-skeleton animation="gradient" rowCol="{{[{ width: '140rpx', height: '22rpx', marginBottom: '8rpx' }]}}" />
                <!-- 简介第一行 -->
                <t-skeleton animation="gradient" rowCol="{{[{ width: '100%', height: '22rpx', marginBottom: '4rpx' }]}}" />
                <!-- 简介第二行 -->
                <t-skeleton animation="gradient" rowCol="{{[{ width: '80%', height: '22rpx' }]}}" />
              </view>
            </view>
          </view>

          <!-- 真实内容 -->
          <ripple wx:if="{{!item.loading}}" color="rgba(0, 0, 0, 0.5)" duration="800">
            <view bind:tap="onClubTap" data-club-id="{{item.club_id}}">
              <!-- 灰色蒙层 -->
              <view wx:if="{{item.isDelete}}" class="club-overlay">
                <text>协会已删除</text>
              </view>
            
            <!-- 上部分：协会名称 -->
            <view class="club-name-header">
              <text class="club-name">{{item.club_name}}</text>
              <!-- 状态标签 -->
              <view class="club-status" wx:if="{{item.isDelete}}">
                <text class="status-tag deleted">已删除</text>
              </view>
            </view>
            
            <!-- 下部分：左边封面，右边信息 -->
            <view class="club-main-content">
              <!-- 左边：协会封面 -->
              <view class="club-cover-wrapper">
                <t-image 
                  src="{{item.cover_url_thumb}}" 
                  width="150rpx" 
                  height="150rpx" 
                  mode="aspectFill"
                  error="default"
                  style="border-radius: 8rpx;"
                />
              </view>
              
              <!-- 右边：协会信息 -->
              <view class="club-info-wrapper">
                <text class="club-title">{{item.club_name}}</text>
                <text class="club-president">会长：{{item.president_info.president_username || '暂无'}}</text>
                <text class="club-description">{{item.description}}</text>
              </view>
            </view>
          </ripple>
        </view>
      </view>
      
      <!-- 空状态显示 -->
      <view wx:elif="{{clubList.length === 0 && clubEmpty}}" class="empty-state">
        <t-icon name="shop" size="120rpx" color="#ddd" />
        <text class="empty-text">暂无协会</text>
        <text class="empty-desc">还没有加入任何协会哦</text>
      </view>
    </view>

    <!-- 底部安全距离 -->
    <view class="bottom-safe-area"></view>
  </scroll-view>

  <!-- 嵌套的club-manage弹窗 -->
  <expandable-container_fullscreen 
    wx:if="{{nestedClubManage.visible}}"
    id="nestedClubManagePopup" 
    expanded-width="750" 
    expanded-height="1800" 
    bg-color="#f3e3f3ff"
    fullscreen-top-padding="{{0}}"
    bind:collapse="onNestedClubManageCollapse"
    bind:collapsed="onNestedClubManageCollapsed"
    bind:contentReady="onNestedClubManageContentReady"
  >
    <view slot="trigger"></view>
    <view slot="content" class="nested-popup-shell">
      <!-- 骨架屏 - 覆盖在panel上面 -->
      <view wx:if="{{nestedClubManage.loading}}" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 999; background: #f3e3f3ff;">
        <club-manage-skeleton />
      </view>
      
      <!-- 真实 panel 组件 - 延迟渲染 -->
      <block wx:if="{{nestedClubManage.renderPanel}}">
        <club-manage-panel
          id="nestedClubManagePanel"
          club-id="{{nestedClubManage.clubId}}"
          bind:loaded="onNestedClubManageLoaded"
          bind:update="onNestedClubManageUpdate"
          bind:close="closeNestedClubManage"
        />
      </block>
    </view>
  </expandable-container_fullscreen>

  <!-- 嵌套的club-detail弹窗 -->
  <expandable-container_fullscreen 
    wx:if="{{nestedClubDetail.visible}}"
    id="nestedClubDetailPopup" 
    expanded-width="750" 
    expanded-height="1800" 
    bg-color="#f7f8fa"
    fullscreen-top-padding="{{0}}"
    bind:collapse="onNestedClubDetailCollapse"
    bind:collapsed="onNestedClubDetailCollapsed"
    bind:contentReady="onNestedClubDetailContentReady"
  >
    <view slot="trigger"></view>
    <view slot="content" class="nested-popup-shell">
      <!-- 骨架屏 - 覆盖在panel上面 -->
      <view wx:if="{{nestedClubDetail.loading}}" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 999; background: #f7f8fa;">
        <club-detail-skeleton />
      </view>
      
      <!-- 真实 panel 组件 - 延迟渲染 -->
      <block wx:if="{{nestedClubDetail.renderPanel}}">
        <club-detail-panel
          id="nestedClubDetailPanel"
          club-id="{{nestedClubDetail.clubId}}"
          bind:loaded="onNestedClubDetailLoaded"
          bind:update="onNestedClubDetailUpdate"
          bind:close="closeNestedClubDetail"
        />
      </block>
    </view>
  </expandable-container_fullscreen>

  <!-- 嵌套的club-joined弹窗 -->
  <expandable-container_fullscreen 
    wx:if="{{nestedClubJoined.visible}}"
    id="nestedClubJoinedPopup" 
    expanded-width="750" 
    expanded-height="1800" 
    bg-color="#f3e3f3ff"
    fullscreen-top-padding="{{0}}"
    bind:collapse="onNestedClubJoinedCollapse"
    bind:collapsed="onNestedClubJoinedCollapsed"
    bind:contentReady="onNestedClubJoinedContentReady"
  >
    <view slot="trigger"></view>
    <view slot="content" class="nested-popup-shell">
      <!-- 骨架屏 - 覆盖在panel上面 -->
      <view wx:if="{{nestedClubJoined.loading}}" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 999; background: #f3e3f3ff;">
        <club-joined-skeleton />
      </view>
      
      <!-- 真实 panel 组件 - 延迟渲染 -->
      <block wx:if="{{nestedClubJoined.renderPanel}}">
        <club-joined-panel
          id="nestedClubJoinedPanel"
          club-id="{{nestedClubJoined.clubId}}"
          bind:loaded="onNestedClubJoinedLoaded"
          bind:update="onNestedClubJoinedUpdate"
          bind:navigateEvent="onNavigateEventFromJoined"
          bind:navigateClub="onNavigateClubFromJoined"
          bind:close="closeNestedClubJoined"
        />
      </block>
    </view>
  </expandable-container_fullscreen>
</view>
