<view class="container">
  <view class="applications-list">
    <block wx:if="{{applications.length > 0}}">
      <view wx:for="{{applications}}" wx:key="index" class="application-item">
        <!-- 折叠状态的基础信息 -->
        <view class="application-summary" bind:tap="toggleExpand" data-index="{{index}}">
          <view class="summary-left">
            <image class="user-avatar-small" src="{{userInfo.avatarUrl || '/assets/images/default-avatar.png'}}" mode="aspectFill"></image>
            <view class="user-name">{{item.club_name}}</view>
          </view>
          <view class="summary-right">
            <!-- 待审批状态显示撤回按钮 -->
            <block wx:if="{{!item.processedDate}}">
              <view class="summary-status">正在审批</view>
              <van-button 
                round 
                color="rgb(255, 87, 34)" 
                size="mini" 
                bind:click="showWithdrawDialog" 
                data-applicationid="{{item.applicationID}}"
                custom-class="summary-btn withdraw-btn"
                catch:tap="stopPropagation"
              >撤回</van-button>
            </block>
            <!-- 已处理状态显示状态 -->
            <view wx:else class="summary-status {{item.approved ? 'status-approved' : 'status-rejected'}}">
              {{item.approved ? '已通过' : '已拒绝'}}
            </view>
            <!-- 展开箭头 -->
            <van-icon name="{{item.expanded ? 'arrow-up' : 'arrow-down'}}" class="expand-arrow" />
          </view>
        </view>
        
        <!-- 展开状态的详细信息 -->
        <view class="application-details" wx:if="{{item.expanded}}">
          <van-cell-group>
            <van-cell title="申请时间" value="{{item.applicatedDate}}" />
            <block wx:if="{{item.processedDate}}">
              <van-cell title="处理人" value="{{item.processed_user}}" />
              <van-cell title="处理时间" value="{{item.processedDate}}" />
              <van-cell wx:if="{{item.opinion}}" title="处理意见" value="{{item.opinion}}" />
            </block>
          </van-cell-group>
        </view>
      </view>
    </block>
    <van-empty wx:else description="暂无申请记录" />
  </view>

<!-- 撤回确认对话框 -->
<van-dialog
  title="确认撤回申请"
  show="{{ showWithdrawDialog }}"
  show-cancel-button
  bind:confirm="handleWithdraw"
  bind:close="closeDialog"
  confirm-button-color="rgb(255, 87, 34)"
  message="确定要撤回这个协会申请吗？撤回后无法恢复。"
/>
</view> 