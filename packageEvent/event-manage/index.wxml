<!-- 简洁现代化活动管理页面 -->
<view class="modern-container">

  <!-- 主要内容 -->
  <scroll-view class="main-scroll" scroll-y="true" wx:if="{{featuredEvent}}">
    <!-- 信息展示区 -->
    <view class="info-section">
      <!-- 活动图片轮播 - 显示2.5个项目 -->
      <view class="images-swiper fade-in-up" wx:if="{{featuredEvent.process_images && featuredEvent.process_images.length > 0}}">
        <swiper 
          class="images-swiper-container" 
          indicator-dots="{{false}}" 
          autoplay="{{true}}" 
          interval="4000" 
          duration="500"
          display-multiple-items="2.5"
          previous-margin="40rpx"
          next-margin="40rpx"
          bindchange="onSwiperChange"
        >
          <swiper-item class="images-swiper-item" wx:for="{{featuredEvent.process_images}}" wx:key="*this">
            <view class="image-wrapper">
              <image 
                class="swiper-image" 
                src="{{item}}" 
                mode="aspectFill" 
                bindtap="previewImage" 
                data-url="{{item}}" 
                data-index="{{index}}"
              />
            </view>
          </swiper-item>
        </swiper>
        
        <!-- 状态标签 -->
        <view class="status-tag {{featuredEvent.end_time ? 'ended' : 'active'}}">
          {{featuredEvent.end_time ? '已结束' : '进行中'}}
        </view>
        
        <!-- 图片指示器 -->
        <view class="images-indicator" wx:if="{{featuredEvent.process_images.length > 1}}">
          <view class="indicator-dots">
            <view 
              class="indicator-dot {{index === currentImageIndex ? 'active' : ''}}" 
              wx:for="{{featuredEvent.process_images}}" 
              wx:key="*this"
            ></view>
          </view>
        </view>
      </view>

      <!-- 新增：地图展示 -->
      <view class="card fade-in-up-delay-1" wx:if="{{featuredEvent.location_data}}" style="margin-top: 24rpx;">
        <view class="location-card">
          <view class="location-map" bindtap="openLocation">
            <image 
              class="map-image"
              src="https://maps.geoapify.com/v1/staticmap?style=osm-bright-grey&width=600&height=300&center=lonlat:{{featuredEvent.location_data.longitude}},{{featuredEvent.location_data.latitude}}&zoom=15&marker=lonlat:{{featuredEvent.location_data.longitude}},{{featuredEvent.location_data.latitude}};type:awesome;color:%23ff6b9d;size:28&scaleFactor=2&apiKey=b8568cb9afc64fad861a69edbddb2658"
              mode="aspectFill"
            />
            <view class="location-overlay">
              <view class="location-name">{{featuredEvent.location_data.name || featuredEvent.location}}</view>
              <view class="location-action">
                <van-icon name="guide-o" size="16" color="#ffffff" />
                <text>点击导航</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 活动详细信息卡片 -->
      <view class="card fade-in-up-delay-1">
        <view class="detail-info-card">
          <!-- 活动标题 -->
          <view class="event-title">{{featuredEvent.title}}</view>
          
          <!-- 基本信息段落 -->
          <view class="basic-info-text">
            <view class="info-text-item">
              <van-icon name="clock-o" size="16" color="#ff6b9d" />
              <text class="info-text">开始时间：{{featuredEvent.start_time || '时间待定'}}</text>
            </view>
            <view class="info-text-item">
              <van-icon name="manager-o" size="16" color="#ff6b9d" />
              <text class="info-text">主办方：{{featuredEvent.club_name}}</text>
            </view>
          </view>

          <!-- 新增：统计区域 -->
          <view class="stats-card" style="margin-top: 32rpx;">
            <view class="stats-row">
              <view class="stat-item">
                <count-num 
                  value="{{featuredEvent.join_count || 0}}" 
                  size="large"
                  color="custom"
                  customStyle="color: #ff6b9d; font-size: 32rpx;"
                  fontWeight="bold"
                  duration="{{800}}"
                  delay="{{600}}"
                />  
                <view class="stat-label">参与人数</view>
              </view>
              <view class="stat-item">
                <count-num 
                  value="{{featuredEvent.clockin_count || 0}}" 
                  size="large"
                  color="custom"
                  customStyle="color: #ff6b9d; font-size: 32rpx;"
                  fontWeight="bold"
                  duration="{{800}}"
                  delay="{{600}}"
                />  
                <view class="stat-label">已打卡</view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 可编辑信息块区域 -->
      <view class="card fade-in-up-delay-1">
        <view class="create-info-card">
          <!-- 信息网格 -->
          <view class="create-info-grid">
            <!-- 活动日程 - 单个块 -->
            <view class="create-info-item single-block" bindtap="editSchedule">
              <van-icon name="replay" size="24" color="#ff6b9d" />
              <view class="create-info-content">
                <view class="create-info-label">活动日程</view>
                <view class="create-info-value">
                  {{scheduleDisplay || '点击创建日程'}}
                </view>
              </view>
            </view>
            
            <!-- 新增：预计开始时间 - 单个块 -->
            <view class="create-info-item single-block {{featuredEvent.actual_startTime ? 'disabled' : ''}}" bindtap="{{featuredEvent.actual_startTime ? '' : 'editPreSchedule'}}">
              <van-icon name="clock-o" size="24" color="{{featuredEvent.actual_startTime ? '#999' : '#ff6b9d'}}" />
              <view class="create-info-content">
                <view class="create-info-label">预计开始时间</view>
                <view class="create-info-value">
                  {{featuredEvent.pre_startTime_display || '点击设置时间'}}
                  <text class="disabled-hint" wx:if="{{featuredEvent.actual_startTime}}">(活动已开始)</text>
                </view>
              </view>
            </view>
            
            <!-- 新增：预计结束时间 - 单个块 -->
            <view class="create-info-item single-block {{featuredEvent.actual_startTime ? 'disabled' : ''}}">
              <van-icon name="clock" size="24" color="{{featuredEvent.actual_startTime ? '#999' : '#ff6b9d'}}" />
              <view class="create-info-content">
                <view class="create-info-label">预计结束时间</view>
                <view class="create-info-value">
                  {{featuredEvent.pre_endTime_display || '待设置'}}
                  <text class="disabled-hint" wx:if="{{featuredEvent.actual_startTime}}">(活动已开始)</text>
                </view>
              </view>
            </view>
            
            <!-- 新增：实际开始时间 - 单个块（只显示） -->
            <view class="create-info-item single-block">
              <van-icon name="play-circle" size="24" color="#52c41a" />
              <view class="create-info-content">
                <view class="create-info-label">实际开始时间</view>
                <view class="create-info-value">
                  {{featuredEvent.actual_startTime_display || '未开始'}}
                </view>
              </view>
            </view>
            
            <!-- 新增：实际结束时间 - 单个块（只显示） -->
            <view class="create-info-item single-block">
              <van-icon name="stop-circle" size="24" color="#f5222d" />
              <view class="create-info-content">
                <view class="create-info-label">实际结束时间</view>
                <view class="create-info-value">
                  {{featuredEvent.actual_endTime_display || '未结束'}}
                </view>
              </view>
            </view>
            
            <!-- 活动预算/花费 - 单个块 -->
            <view class="create-info-item single-block" bindtap="editCost">
              <van-icon name="gold-coin-o" size="24" color="#ff6b9d" />
              <view class="create-info-content">
                <view class="create-info-label">预算/花费</view>
                <view class="create-info-value">¥{{featuredEvent.budget || '0'}} / ¥{{featuredEvent.real_cost || '0'}}</view>
              </view>
            </view>
            
            <!-- 活动图片 - 单个块 -->
            <view class="create-info-item single-block" bindtap="editImages">
              <van-icon name="photo-o" size="24" color="#ff6b9d" />
              <view class="create-info-content">
                <view class="create-info-label">活动图片</view>
                <view class="create-info-value">
                  {{featuredEvent.process_images && featuredEvent.process_images.length > 0 ? '已添加 (' + featuredEvent.process_images.length + '张)' : '点击添加图片'}}
                </view>
              </view>
            </view>
            
            <!-- 活动地址 - 单个块 -->
            <view class="create-info-item single-block" bindtap="editLocation">
              <van-icon name="location-o" size="24" color="#ff6b9d" />
              <view class="create-info-content">
                <view class="create-info-label">活动地址</view>
                <view class="create-info-value">
                  {{featuredEvent.location_data && featuredEvent.location_data.name ? featuredEvent.location_data.name : (featuredEvent.location || '点击设置地址')}}
                </view>
              </view>
            </view>
            
            <!-- 活动简介 - 双倍宽度和高度 -->
            <view class="create-info-item double-width double-height" bindtap="editContent">
              <van-icon name="description" size="24" color="#ff6b9d" />
              <view class="create-info-content">
                <view class="create-info-label">活动简介</view>
                <view class="create-info-value description-text">{{featuredEvent.content || '点击添加简介'}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 参与者展示 -->
      <view class="card fade-in-up-delay-1" wx:if="{{featuredEvent.members && featuredEvent.members.length > 0}}">
        <view class="participants-card">
          <view class="participants-header">
            <text class="participants-title">参与者 ({{featuredEvent.join_count || 0}})</text>
            <text class="participants-subtitle">{{featuredEvent.clockin_count || 0}}人已打卡</text>
          </view>
          <view class="participants-grid">
            <view 
              class="participant-item" 
              wx:for="{{featuredEvent.members}}" 
              wx:key="user_id"
              wx:if="{{index < 8}}"
            >
              <view class="participant-avatar">
                <image 
                  class="avatar-img" 
                  src="{{item.avatar || '/assets/icons/user.png'}}" 
                />
                <view class="checkin-badge" wx:if="{{item.clockinDate}}">
                  <van-icon name="success" size="10" color="#ffffff" />
                </view>
              </view>
              <view class="participant-name">{{item.user_name || item.username || '用户'}}</view>
            </view>
            
            <!-- 更多参与者 -->
            <view class="participant-item more-participants" wx:if="{{featuredEvent.members.length > 8}}" bindtap="viewAllMembers">
              <view class="more-avatar">
                <text class="more-text">+{{featuredEvent.members.length - 8}}</text>
              </view>
              <view class="participant-name">更多</view>
            </view>
          </view>
        </view>
      </view>

      <!-- 操作区 -->
      <view class="action-section fade-in-up-delay-1">
        <view class="actions-container">
          <!-- 开始/结束活动按钮 -->
          <view 
            class="action-btn {{featuredEvent.actual_endTime ? 'disabled' : (featuredEvent.actual_startTime ? 'danger' : (canStartNow ? 'primary' : 'disabled'))}}"
            bindtap="{{featuredEvent.actual_endTime ? '' : (featuredEvent.actual_startTime ? 'endEvent' : (canStartNow ? 'startEvent' : 'showTimeHint'))}}"
            data-event-id="{{featuredEvent.event_id}}"
          >
            <van-icon name="{{featuredEvent.actual_endTime ? 'success' : (featuredEvent.actual_startTime ? 'stop-circle-o' : (canStartNow ? 'play-circle-o' : 'clock-o'))}}" size="20" />
            <text>{{featuredEvent.actual_endTime ? '已结束' : (featuredEvent.actual_startTime ? '结束活动' : (canStartNow ? '开始活动' : '等待开始时间'))}}</text>
          </view>
          
          <!-- 时间提示信息 -->
          <view class="time-hint" wx:if="{{!featuredEvent.actual_endTime && !featuredEvent.actual_startTime && !canStartNow && featuredEvent.pre_startTime}}">
            <van-icon name="info-o" size="14" color="#999" />
            <text class="hint-text">{{timeHintText}}</text>
          </view>
          
          <!-- 新增：结束日程按钮 -->
          <view 
            class="action-btn warning" 
            wx:if="{{currentSchedule && !currentSchedule.end_time && !featuredEvent.actual_endTime}}"
            bindtap="showEndScheduleDialog"
          >
            <van-icon name="stop" size="20" />
            <text>结束日程</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 无活动状态 -->
  <view class="empty-container" wx:elif="{{!isLoading && isEmpty}}">
    <view class="empty-state">
      <van-icon name="warning-o" size="64" color="#ff6b9d" />
      <text class="empty-title">活动不存在</text>
      <text class="empty-desc">该活动可能已被删除或不存在</text>
    </view>
  </view>

  <!-- 加载中状态 -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <van-loading type="spinner" color="#ff6b9d" />
    <text class="loading-text">加载中...</text>
  </view>
</view>


<!-- 简介编辑弹窗 -->
<van-popup 
  show="{{ showContentPopup }}" 
  position="bottom" 
  round
  close-on-click-overlay
  bind:close="closeContentPopup"
  custom-class="content-popup"
  z-index="2000"
  safe-area-inset-bottom
>
  <view class="popup-container">
    <view class="popup-header">
      <text class="popup-title">编辑活动简介</text>
      <van-icon name="cross" bind:click="closeContentPopup" color="#666" />
    </view>
    
    <view class="popup-content">
      <van-field
        value="{{ tempContent }}"
        placeholder="请详细描述活动内容和要求"
        type="textarea"
        autosize="{{ { minHeight: 100, maxHeight: 200 } }}"
        border="{{ false }}"
        bind:change="onTempContentChange"
        maxlength="1000"
        show-word-limit
      />
      
      <view class="popup-actions">
        <view 
          class="action-btn primary"
          bindtap="confirmContent"
        >
          <van-icon name="success" size="16" />
          <text>确认</text>
        </view>
      </view>
    </view>
  </view>
</van-popup>

<!-- 图片管理弹窗 -->
<van-popup 
  show="{{ showImageDialog }}" 
  position="bottom" 
  round
  close-on-click-overlay
  bind:close="closeImageDialog"
  custom-class="image-popup"
  z-index="2000"
  safe-area-inset-bottom
>
  <view class="popup-container">
    <view class="popup-header">
      <text class="popup-title">管理活动图片</text>
      <van-icon name="cross" bind:click="closeImageDialog" color="#666" />
    </view>
    
    <view class="popup-content">
      <view class="images-tip">
        <van-icon name="info-o" size="14" color="#ff6b9d" />
        <text>拖拽调整顺序，第一张将自动作为封面图</text>
      </view>
      
      <!-- 添加外层容器并阻止事件冒泡 -->
      <view class="drag-container" >
        <drag-img 
          id="drag-img-{{featuredEvent.event_id}}"
          previewSize="90" 
          defaultImgList="{{featuredEvent.process_images || []}}" 
          maxCount="9"
          columns="3"
          gap="10"
          customClass="drag-img-container"
          itemClass="drag-img-item"
        />
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="popup-actions">
      <view 
        class="action-btn primary"
        bindtap="saveImageChanges" 
        data-event-id="{{featuredEvent.event_id}}"
      >
        <van-icon name="success" size="16" />
        <text>保存图片</text>
      </view>
    </view>
  </view>
</van-popup>

<!-- 时间选择器 -->
<van-popup 
  show="{{ showTimePickerPopup }}" 
  position="bottom"
  close-on-click-overlay
  bind:close="closeTimePicker"
  z-index="4000"
  safe-area-inset-bottom
  overlay-style="z-index: 3999;"
>
  <van-datetime-picker
    type="datetime"
    value="{{ currentDate }}"
    min-date="{{ minDate }}"
    max-date="{{ maxDate }}"
    bind:confirm="onTimeConfirm"
    bind:cancel="closeTimePicker"
    custom-style="z-index: 4001;"
  />
</van-popup>

<!-- 活动时间选择器 -->
<van-popup 
  show="{{ showTimeOfDayPickerPopup }}" 
  position="bottom"
  close-on-click-overlay
  bind:close="closeTimeOfDayPicker"
  z-index="4000"
  safe-area-inset-bottom
  overlay-style="z-index: 3999;"
>
  <van-datetime-picker
    type="time"
    value="{{ scheduleForm.activity_time }}"
    bind:confirm="onTimeOfDayConfirm"
    bind:cancel="closeTimeOfDayPicker"
    custom-style="z-index: 4001;"
  />
</van-popup>

<!-- 费用修改弹窗 -->
<van-dialog
  use-slot
  title="修改实际花费"
  show="{{ showCostDialog }}"
  show-cancel-button
  close-on-click-overlay
  bind:confirm="confirmCost"
  bind:cancel="closeCostDialog"
  custom-class="cost-dialog"
  z-index="2100"
>
  <view class="cost-input-container">
    <van-field
      value="{{ costInput }}"
      placeholder="请输入实际花费金额"
      type="digit"
      bind:change="onCostChange"
      border="{{false}}"
      custom-class="cost-input"
    />
  </view>
</van-dialog>

<!-- 地址编辑弹窗 -->
<van-popup 
  show="{{ showLocationPopup }}" 
  position="bottom" 
  round
  close-on-click-overlay
  bind:close="closeLocationPopup"
  custom-class="location-popup"
  z-index="2000"
  safe-area-inset-bottom
>
  <view class="popup-container">
    <view class="popup-header">
      <text class="popup-title">编辑活动地址</text>
      <van-icon name="cross" bind:click="closeLocationPopup" color="#666" />
    </view>
    
    <view class="popup-content">
      <view class="form-item">
        <text class="form-label">地址名称</text>
        <van-field
          value="{{ locationForm.name }}"
          placeholder="请输入地址名称"
          bind:change="onLocationNameChange"
          border="{{false}}"
          custom-class="location-input"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">详细地址</text>
        <van-field
          value="{{ locationForm.address }}"
          placeholder="请输入详细地址"
          bind:change="onLocationAddressChange"
          border="{{false}}"
          custom-class="location-input"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">选择位置</text>
        <view class="location-picker" bindtap="chooseLocation">
          <text class="{{locationForm.latitude && locationForm.longitude ? 'has-value' : 'placeholder'}}">
            {{locationForm.latitude && locationForm.longitude ? '已选择位置 (' + locationForm.latitude + ', ' + locationForm.longitude + ')' : '点击选择地图位置'}}
          </text>
          <van-icon name="location-o" size="16" color="#ff6b9d" />
        </view>
      </view>
    </view>
    
    <view class="popup-actions">
      <view class="action-btn secondary" bindtap="closeLocationPopup">
        <text>取消</text>
      </view>
      <view class="action-btn primary" bindtap="confirmLocation">
        <text>确认</text>
      </view>
    </view>
  </view>
</van-popup>

<!-- 新增：日程编辑弹窗（复制自event-create） -->
<van-popup 
  show="{{ showSchedulePopup }}" 
  position="bottom" 
  round
  close-on-click-overlay
  bind:close="closeSchedulePopup"
  custom-class="schedule-popup"
  z-index="2000"
  safe-area-inset-bottom
>
  <view class="popup-container">
    <view class="popup-header">
      <text class="popup-title">{{currentSchedule ? '修改定期日程' : '设置定期日程'}}</text>
      <van-icon name="cross" bind:click="closeSchedulePopup" color="#666" />
    </view>
    
    <view class="popup-content">
      <!-- 重复周期选择 -->
      <view class="form-section">
        <text class="section-title">重复周期</text>
        <van-radio-group value="{{ scheduleForm.schedule_type }}" bind:change="onScheduleTypeChange">
          <van-radio name="weekly" icon-size="18px">每周</van-radio>
          <van-radio name="monthly" icon-size="18px">每月</van-radio>
        </van-radio-group>
      </view>

      <!-- 执行日期选择 -->
      <view class="form-section">
        <text class="section-title">执行日期</text>
        
        <!-- 周选择器 -->
        <view wx:if="{{ scheduleForm.schedule_type === 'weekly' }}" class="date-selector">
          <select-day 
            title="选择星期"
            value="{{ scheduleForm.weekdays }}"
            show="{{ showWeekdayPopup }}"
            bind:display="showWeekdaySelector"
            bind:close="closeWeekdayPopup"
            bind:confirm="onWeekdaysChange"
          />
        </view>
        
        <!-- 月选择器 -->
        <view wx:if="{{ scheduleForm.schedule_type === 'monthly' }}" class="date-selector">
          <select-date 
            title="选择日期"
            value="{{ scheduleForm.month_days }}"
            show="{{ showMonthdayPopup }}"
            bind:display="showMonthdaySelector"
            bind:close="closeMonthdayPopup"
            bind:confirm="onMonthdaysChange"
          />
        </view>
      </view>

      <!-- 活动时间选择 -->
      <view class="form-section">
        <text class="section-title">活动时间</text>
        <view class="time-selector" bindtap="showTimeOfDayPicker">
          <text class="time-display">{{ scheduleForm.activity_time }}</text>
          <van-icon name="arrow" size="16" color="#666" />
        </view>
      </view>

      <!-- 提前通知 -->
      <view class="form-section">
        <text class="section-title">提前通知</text>
        <view class="slider-container">
          <van-slider
            value="{{ scheduleForm.advance_hours_slider }}"
            min="0"
            max="6"
            step="1"
            bar-height="6px"
            active-color="#ff6b9d"
            bind:change="onAdvanceHoursChange"
          />
          <text class="slider-label">{{ advanceHourLabels[scheduleForm.advance_hours_slider] }}</text>
        </view>
      </view>
      
      <!-- 操作按钮 -->
      <view class="popup-actions">
        <view class="action-btn secondary" bindtap="closeSchedulePopup">
          <text>取消</text>
        </view>
        <!-- 如果是修改已有日程，显示结束按钮 -->
        <view wx:if="{{ currentSchedule && !currentSchedule.end_time }}" class="action-btn warning" bindtap="endScheduleFromPopup">
          <text>结束日程</text>
        </view>
        <!-- 如果已设置日程且是新建模式，显示清除按钮 -->
        <view wx:elif="{{ scheduleDisplay && !currentSchedule }}" class="action-btn warning" bindtap="clearSchedule">
          <text>清除日程</text>
        </view>
        <view class="action-btn primary" bindtap="confirmSchedule">
          <text>确认</text>
        </view>
      </view>
    </view>
  </view>
</van-popup>

<!-- 新增：结束日程确认对话框 -->
<van-dialog
  use-slot
  title="确认结束日程"
  show="{{ showEndScheduleDialog }}"
  show-cancel-button
  close-on-click-overlay
  bind:confirm="confirmEndSchedule"
  bind:cancel="closeEndScheduleDialog"
  custom-class="end-schedule-dialog"
  z-index="2100"
>
  <view class="dialog-content">
    <view class="dialog-text">结束后将停止自动生成新活动，已生成的活动不受影响。确认结束吗？</view>
  </view>
</van-dialog>

<!-- 新增：预计时间编辑弹窗 -->
<van-popup 
  show="{{ showPreSchedulePopup }}" 
  position="bottom" 
  round
  close-on-click-overlay
  bind:close="closePreSchedulePopup"
  custom-class="pre-schedule-popup"
  z-index="2000"
  safe-area-inset-bottom
>
  <view class="popup-container">
    <view class="popup-header">
      <text class="popup-title">编辑预计时间</text>
      <van-icon name="cross" bind:click="closePreSchedulePopup" color="#666" />
    </view>
    
    <view class="popup-content">
      <!-- 预计开始时间选择 -->
      <view class="form-section">
        <text class="section-title">预计开始时间</text>
        <view class="time-selector" bindtap="showPreScheduleDateTimePicker">
          <text class="time-display">{{ preScheduleForm.startTimeDisplay || '请选择时间'}}</text>
          <van-icon name="arrow" size="16" color="#666" />
        </view>
      </view>

      <!-- 活动时长选择 -->
      <view class="form-section">
        <text class="section-title">活动时长</text>
        <view class="duration-slider-container">
          <van-slider
            value="{{ preScheduleForm.duration }}"
            min="1"
            max="8"
            step="1"
            bar-height="8rpx"
            active-color="#ff6b9d"
            bind:change="onPreScheduleDurationChange"
          />
          <text class="duration-label">{{ preScheduleForm.durationText }}</text>
        </view>
      </view>

      <!-- 预计结束时间显示 -->
      <view class="form-section">
        <text class="section-title">预计结束时间</text>
        <view class="end-time-display">
          <text class="end-time-text">{{ preScheduleForm.endTimeDisplay || '请先选择开始时间' }}</text>
        </view>
      </view>
      
      <!-- 操作按钮 -->
      <view class="popup-actions">
        <view class="action-btn secondary" bindtap="closePreSchedulePopup">
          <text>取消</text>
        </view>
        <view class="action-btn primary" bindtap="confirmPreSchedule">
          <text>确认</text>
        </view>
      </view>
    </view>
  </view>
</van-popup>

<!-- 新增：预计时间日期时间选择器 -->
<van-popup 
  show="{{ showPreScheduleDateTimePickerPopup }}" 
  position="bottom"
  close-on-click-overlay
  bind:close="closePreScheduleDateTimePicker"
  z-index="4000"
  safe-area-inset-bottom
  overlay-style="z-index: 3999;"
>
  <van-datetime-picker
    type="datetime"
    value="{{ preScheduleCurrentDate }}"
    min-date="{{ minDate }}"
    max-date="{{ maxDate }}"
    bind:confirm="onPreScheduleDateTimeConfirm"
    bind:cancel="closePreScheduleDateTimePicker"
    custom-style="z-index: 4001;"
  />
</van-popup>
