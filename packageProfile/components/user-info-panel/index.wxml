<!-- packageProfile/components/user-info-panel/index.wxml -->
<view class="user-info-panel">

  <scroll-view scroll-y="true" class="panel-scroll">
    <view wx:if="{{loading}}" class="loading-container">
      <van-loading size="24px" type="spinner" color="#1989fa" />
      <view class="loading-text">加载中...</view>
    </view>
    
    <view wx:else class="user-info-container">
      <view class="avatar-section">
        <image class="avatar" src="{{userInfo.avatar}}" mode="aspectFill"></image>
        <view class="user-name">{{userInfo.username}}</view>
        <view class="user-role">{{userInfo.roles_join}}</view>
      </view>
      
      <view class="info-section">
        <view class="info-item">
          <view class="info-label">账号ID</view>
          <view class="info-value">{{userInfo.id}}</view>
        </view>
        
        <!-- 可编辑项 - 姓名 -->
        <view class="info-item">
          <view class="info-label">姓名</view>
          <view class="info-value-wrap">
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.username}}</view>
            <input wx:else class="info-input" value="{{formData.name}}" data-field="name" bindinput="onInputChange" placeholder="请输入姓名" />
            <view wx:if="{{!isEditing}}" class="edit-icon" catchtap="onEditItem" data-field="name">
              <van-icon name="edit" size="16px" color="#1989fa" />
            </view>
          </view>
        </view>
        
        <!-- 可编辑项 - 性别 -->
        <view class="info-item">
          <view class="info-label">性别</view>
          <view class="info-value-wrap">
            <view wx:if="{{!isEditing}}" class="info-value">{{formData.gender || '未设置'}}</view>
            <picker wx:else mode="selector" range="{{genderOptions}}" value="{{genderIndex}}" bindchange="onGenderChange">
              <view class="info-input picker">{{genderOptions[genderIndex]}}</view>
            </picker>
            <view wx:if="{{!isEditing}}" class="edit-icon" catchtap="onEditItem" data-field="gender">
              <van-icon name="edit" size="16px" color="#1989fa" />
            </view>
          </view>
        </view>
        
        <!-- 可编辑项 - 手机号 -->
        <view class="info-item">
          <view class="info-label">手机号</view>
          <view class="info-value-wrap">
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.phone || '未设置'}}</view>
            <input wx:else class="info-input" type="number" value="{{formData.phone}}" data-field="phone" bindinput="onInputChange" placeholder="请输入手机号" maxlength="11" />
            <view wx:if="{{!isEditing}}" class="edit-icon" catchtap="onEditItem" data-field="phone">
              <van-icon name="edit" size="16px" color="#1989fa" />
            </view>
          </view>
        </view>
        
        <!-- 可编辑项 - 邮箱 -->
        <view class="info-item">
          <view class="info-label">邮箱</view>
          <view class="info-value-wrap">
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.email || '未设置'}}</view>
            <input wx:else class="info-input" type="text" value="{{formData.email}}" data-field="email" bindinput="onInputChange" placeholder="请输入邮箱" />
            <view wx:if="{{!isEditing}}" class="edit-icon" catchtap="onEditItem" data-field="email">
              <van-icon name="edit" size="16px" color="#1989fa" />
            </view>
          </view>
        </view>

        <!-- 可编辑项 - 部门 -->
        <view class="info-item">
          <view class="info-label">部门</view>
          <view class="info-value-wrap">
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.department || '未设置'}}</view>
            <picker
              wx:else
              mode="selector"
              range="{{departmentOptions}}"
              value="{{departmentIndex}}"
              bindchange="onDepartmentChange"
            >
              <view class="info-input picker">{{departmentOptions[departmentIndex] || '请选择部门'}}</view>
            </picker>
            <view wx:if="{{!isEditing}}" class="edit-icon" catchtap="onEditItem" data-field="department">
              <van-icon name="edit" size="16px" color="#1989fa" />
            </view>
          </view>
        </view>

        <!-- 可编辑项 - 职位 -->
        <view class="info-item">
          <view class="info-label">职位</view>
          <view class="info-value-wrap">
            <view wx:if="{{!isEditing}}" class="info-value">{{userInfo.position || '未设置'}}</view>
            <input wx:else class="info-input" type="text" value="{{formData.position}}" data-field="position" bindinput="onInputChange" placeholder="请输入职位" />
            <view wx:if="{{!isEditing}}" class="edit-icon" catchtap="onEditItem" data-field="position">
              <van-icon name="edit" size="16px" color="#1989fa" />
            </view>
          </view>
        </view>
      </view>
      
      <view class="action-section" wx:if="{{isEditing}}">
        <van-button type="default" round bindtap="cancelEdit" class="action-btn">取消</van-button>
        <van-button type="primary" round bindtap="saveUserInfo" loading="{{submitting}}" class="action-btn">保存</van-button>
      </view>
      
      <view class="action-section" wx:if="{{!isEditing}}">
        <van-button type="primary" round bindtap="startEdit" icon="edit">点击编辑</van-button>
      </view>
    </view>
  </scroll-view>
</view>
