<!--packageProfile/components/club-events-panel/index.wxml-->
<view class="container">
  <view class="page-header">
    <view class="title-group">
      <view class="title">æ´»åŠ¨ç»Ÿè®¡</view>
      <view class="subtitle" wx:if="{{clubInfo.club_name}}">{{clubInfo.club_name}}</view>
    </view>
    <view class="header-actions">
      <van-button 
        type="primary" 
        round 
        size="small" 
        icon="down" 
        bindtap="downloadExcel"
        loading="{{downloading}}"
        class="download-btn"
      >
        ä¸‹è½½Excel
      </van-button>
    </view>
  </view>
  
  <view wx:if="{{loading}}" class="loading-container">
    <van-loading size="24px" type="spinner" color="#df76b0" />
    <view class="loading-text">æ­£åœ¨åŠ è½½æ•°æ®...</view>
  </view>
  
  <view wx:else class="content">
    <!-- æ€»ä½“ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-overview">
      <view class="stats-card">
        <view class="stats-number">{{totalEvents}}</view>
        <view class="stats-label">æ´»åŠ¨æ€»æ•°</view>
      </view>
      <view class="stats-card">
        <view class="stats-number">{{totalParticipants}}</view>
        <view class="stats-label">æ€»å‚ä¸äººæ¬¡</view>
      </view>
      <view class="stats-card">
        <view class="stats-number">{{totalCheckedIn}}</view>
        <view class="stats-label">æ€»ç­¾åˆ°äººæ¬¡</view>
      </view>
      <view class="stats-card">
        <view class="stats-number">{{checkinRate}}%</view>
        <view class="stats-label">å¹³å‡ç­¾åˆ°ç‡</view>
      </view>
    </view>
    
    <!-- å›¾è¡¨å±•ç¤ºåŒºåŸŸ -->
    <view class="charts-section" wx:if="{{!hideCharts}}">
      <!-- æœˆåº¦æ´»åŠ¨è¶‹åŠ¿å›¾ -->
      <view class="chart-container" wx:if="{{monthlyChart.length > 0}}">
        <bar-chart 
          data="{{monthlyChart}}" 
          title="æœˆåº¦æ´»åŠ¨è¶‹åŠ¿"
          height="{{280}}"
          bar-color="#df76b0"
          show-value="{{true}}"
        />
      </view>
      
      <!-- æ´»åŠ¨è´¹ç”¨åˆ†å¸ƒé¥¼å›¾ -->
      <view class="chart-container" wx:if="{{budgetChart.length > 0}}">
        <pie-chart 
          data="{{budgetChart}}" 
          title="æ´»åŠ¨é¢„ç®—åˆ†å¸ƒ"
          height="{{280}}"
          colors="{{['#df76b0', '#9c88ff', '#5fb3d4', '#f4b844', '#67c23a']}}"
        />
      </view>
      
      <!-- æ´»åŠ¨ç­¾åˆ°ç‡åˆ†å¸ƒ -->
      <view class="chart-container" wx:if="{{checkinChart.length > 0}}">
        <bar-chart 
          data="{{checkinChart}}" 
          title="å„æ´»åŠ¨ç­¾åˆ°ç‡"
          height="{{300}}"
          bar-color="#5fb3d4"
          show-value="{{true}}"
        />
      </view>
    </view>
    
    <!-- æ´»åŠ¨åˆ—è¡¨ -->
    <view class="list-section">
      <view class="section-title">
        <view class="title-text">æ´»åŠ¨åˆ—è¡¨</view>
        <view class="title-desc">å…±{{events.length}}ä¸ªæ´»åŠ¨</view>
      </view>
      
      <view class="event-list" wx:if="{{events.length > 0}}">
        <view class="event-item" wx:for="{{events}}" wx:key="event_id">
          <view class="event-header">
            <view class="event-title">{{item.title}}</view>
            <view class="event-id">#{{item.event_id}}</view>
          </view>
          <view class="event-info">
            <view class="info-row">
              <text class="info-label">é¢„è®¡æ—¶é—´:</text>
              <text class="info-value">{{item.pre_start_time}}</text>
            </view>
            <view class="info-row" wx:if="{{item.actual_start_time}}">
              <text class="info-label">å®é™…æ—¶é—´:</text>
              <text class="info-value">{{item.actual_start_time}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">åœ°ç‚¹:</text>
              <text class="info-value">{{item.location_name || 'å¾…å®š'}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">é¢„ç®—:</text>
              <text class="info-value budget">Â¥{{item.budget || 0}}</text>
            </view>
            <view class="info-row" wx:if="{{item.real_cost}}">
              <text class="info-label">å®é™…è´¹ç”¨:</text>
              <text class="info-value cost">Â¥{{item.real_cost}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">ç»„ç»‡è€…:</text>
              <text class="info-value">{{item.organizer.user_name}}</text>
            </view>
          </view>
          <view class="event-stats">
            <view class="stat-item">
              <text class="stat-value">{{item.total_participants}}</text>
              <text class="stat-label">æŠ¥å</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{item.checked_in_count}}</text>
              <text class="stat-label">ç­¾åˆ°</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{Math.round(item.checked_in_count/item.total_participants*100) || 0}}%</text>
              <text class="stat-label">ç­¾åˆ°ç‡</text>
            </view>
          </view>
        </view>
      </view>
      
      <view wx:else class="empty-state">
        <view class="empty-icon">ğŸ“Š</view>
        <view class="empty-text">æš‚æ— æ´»åŠ¨æ•°æ®</view>
        <view class="empty-desc">è¯¥åä¼šè¿˜æ²¡æœ‰ä¸¾åŠè¿‡æ´»åŠ¨</view>
      </view>
    </view>
  </view>
</view> 